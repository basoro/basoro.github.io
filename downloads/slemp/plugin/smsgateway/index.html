<div class="tasklist" style="width:640px;height:480px;">
	<div class="tab-nav">
		<span class="on">Setup</span>
		<span class="" onclick="configChange()">Config</span>
		<span class="" onclick="configDatabase()">Database</span>
  </div>
	<div class="tab-con">
		<div id="setup" class="SetSetup" style="display: block;">
			<p>
				<div class='ver'><span style='margin-right:10px'>Tutorial</span>
					<p>How To Use</p>
				</div>
			</p>
		</div>
		<div id="config" class="SetConfig"  style="display: none;">
		</div>
		<div id="setup" class="SetDatabase" style="display: none;">
		</div>
  </div>
</div>
<script type="javascript/text">
	$(".tab-nav span").click(function(){
		var i = $(this).index();
		$(this).addClass("on").siblings().removeClass("on");
		$(".tab-con > div").hide().eq(i).show();
		switch(i){
			case 0:
				SetSetup();
				break;
			case 1:
				SetConfig();
				break;
			case 2:
				SetDatabase();
				break;
		}
	});

	function configChange(){
		var con = '<p style="color: #666; margin-bottom: 7px">Hint: Ctrl+F search keyword, Ctrl+G find next, Ctrl+S save, Ctrl+Shift+R find replace</p><textarea style="height: 320px; line-height:18px;" id="textBody"></textarea>\
						<button id="OnlineEditFileBtn" class="btn btn-info btn-sm" style="margin-top:10px;">Submit</button>';
		$(".SetConfig").html(con);
		fileName = '/etc/gammu-smsd';
		var loadT = layer.msg("Loading...",{icon:16,time:0,shade: [0.3, '#000']});
		$.post('/files?action=GetFileBody', 'path=' + fileName, function(rdata) {
			layer.close(loadT);
			$("#textBody").empty().text(rdata.data);
			$(".CodeMirror").remove();
			var editor = CodeMirror.fromTextArea(document.getElementById("textBody"), {
				extraKeys: {"Ctrl-Space": "autocomplete"},
				lineNumbers: true,
				matchBrackets:true,
			});
			editor.focus();
			$(".CodeMirror-scroll").css({"height":"300px","margin":0,"padding":0});
			$("#OnlineEditFileBtn").click(function(){
				$("#textBody").text(editor.getValue());
				confSafe(fileName);
			})
		})
	}

	function confSafe(fileName){
		var data = encodeURIComponent($("#textBody").val());
		var encoding = 'utf-8';
		var loadT = layer.msg('Saving...', {
			icon: 16,
			time: 0
		});
		$.post('/files?action=SaveFileBody', 'data=' + data + '&path=' + fileName+'&encoding='+encoding, function(rdata) {
			layer.close(loadT);
			layer.msg(rdata.msg, {
				icon: rdata.status ? 1 : 2
			});
		});
	}

	function configDatabase(){
		var con = '<p style="color: #666; margin-bottom: 7px">Hint: Ctrl+F search keyword, Ctrl+G find next, Ctrl+S save, Ctrl+Shift+R find replace</p><textarea style="height: 320px; line-height:18px;" id="textBody"></textarea>\
						<button id="OnlineEditFileBtn" class="btn btn-info btn-sm" style="margin-top:10px;">Submit</button>';
		$(".SetDatabase").html(con);
		fileName = '/opt/slemp/server/panel/plugin/smsgateway/sms-config.php';
		var loadT = layer.msg("Loading...",{icon:16,time:0,shade: [0.3, '#000']});
		$.post('/files?action=GetFileBody', 'path=' + fileName, function(rdata) {
			layer.close(loadT);
			$("#textBody").empty().text(rdata.data);
			$(".CodeMirror").remove();
			var editor = CodeMirror.fromTextArea(document.getElementById("textBody"), {
				extraKeys: {"Ctrl-Space": "autocomplete"},
				lineNumbers: true,
				matchBrackets:true,
			});
			editor.focus();
			$(".CodeMirror-scroll").css({"height":"300px","margin":0,"padding":0});
			$("#OnlineEditFileBtn").click(function(){
				$("#textBody").text(editor.getValue());
				confSafe(fileName);
			})
		})
	}

	function confSafe(fileName){
		var data = encodeURIComponent($("#textBody").val());
		var encoding = 'utf-8';
		var loadT = layer.msg('Saving...', {
			icon: 16,
			time: 0
		});
		$.post('/files?action=SaveFileBody', 'data=' + data + '&path=' + fileName+'&encoding='+encoding, function(rdata) {
			layer.close(loadT);
			layer.msg(rdata.msg, {
				icon: rdata.status ? 1 : 2
			});
		});
	}

</script>
